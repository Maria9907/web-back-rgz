{% extends "base.html" %}

{% block title %}Управление лекарствами - Аптека "Здоровье"{% endblock %}

{% block content %}
<div class="container">
    <h1>Управление лекарствами</h1>
    
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}
    
    <div class="admin-actions">
        <a href="{{ url_for('add_medicine') }}" class="btn btn-primary">Добавить лекарство</a>
        <a href="{{ url_for('admin_panel') }}" class="btn btn-secondary">Назад в панель администратора</a>
    </div>
    
    <div class="medicines-list">
        <h2>Список лекарств (всего: {{ total_count }})</h2>
        
        {% if medicines %}
            <table class="medicines-table">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Название</th>
                        <th>Международное название</th>
                        <th>Цена</th>
                        <th>Количество</th>
                        <th>Рецептурный</th>
                        <th>Действия</th>
                    </tr>
                </thead>
                <tbody>
                    {% for medicine in medicines %}
                    <tr>
                        <td>{{ medicine.id }}</td>
                        <td>{{ medicine.name }}</td>
                        <td>{{ medicine.generic_name or '-' }}</td>
                        <td>{{ "%.2f"|format(medicine.price) }} руб.</td>
                        <td>
                            <span class="{{ 'out-of-stock' if medicine.quantity == 0 else 'in-stock' }}">
                                {% if medicine.quantity == 0 %}
                                    Отсутствует
                                {% else %}
                                    {{ medicine.quantity }}
                                {% endif %}
                            </span>
                        </td>
                        <td>
                            {% if medicine.prescription_required %}
                                Да
                            {% else %}
                                Нет
                            {% endif %}
                        </td>
                        <td class="actions">
                            <a href="{{ url_for('edit_medicine', medicine_id=medicine.id) }}" class="btn btn-edit">Редактировать</a>
                            <form action="{{ url_for('delete_medicine', medicine_id=medicine.id) }}" method="POST" class="delete-form">
                                <button type="submit" class="btn btn-delete" onclick="return confirm('Вы уверены, что хотите удалить это лекарство?')">Удалить</button>
                            </form>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- Пагинация -->
            {% if total_pages > 1 %}
                <div class="pagination">
                    {% if page > 1 %}
                        <a href="{{ url_for('admin_medicines', page=page-1) }}" class="btn btn-secondary">← Предыдущие</a>
                    {% endif %}
                    
                    <span class="page-info">Страница {{ page }} из {{ total_pages }}</span>
                    
                    {% if page < total_pages %}
                        <a href="{{ url_for('admin_medicines', page=page+1) }}" class="btn btn-secondary">Следующие →</a>
                    {% endif %}
                </div>
            {% endif %}
        {% else %}
            <p>Лекарства не найдены.</p>
        {% endif %}
    </div>
</div>
{% endblock %}